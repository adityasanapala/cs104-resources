# Lab 8 - Sed Awk

## Activity 1 (SED)

After quickly finishing your C++ script, you realize that instead of "pprint" (the function that you have defined) you have written "printf" to yield strings to the standard output(terminal). Seems like you were not using good IDE and cannot just find and replace all instances of "printf" with "pprint".

Task : Given the file test.cpp, you need to replace all instances of "printf" to "pprint".

You need to ensure that ONLY those instances of "printf" are replaced where it is used a function.

Usage :

sed -f var_change.sed <filename> > output.txt

Eg:

Input ->

printf ("eren");

otherprintf"mikasa");

Output ->

pprint("eren");

otherprintf ("mikasa"); // printf in substring is not changed

Note: You need to take filename as argument to the sed command.


## Activity 2 (SED)

You are given a python script, which, during its execution, generates a message. The message is generated by appending to a variable named message. After running the script, you realize that there is a space at the end of some sentences you append and no space at the end of others.
You want to have a space at the end of every sentence you append to the message (note a sentence must end in a full stop(.)). Write a sed script in add_space.sed to do this.

For Example:

message += "Hello."

should become

message+="Hello."



message+= "Hello."

should become

message+="Hello."



where as the following should remain same

str+="Hi"

message="'''

message+="this is"

message+="correct. "


We will run your script as sed -E -f add_space.sed <filename>.py > <outfilename>.py

Important: Indentation is important in python. It should remain the same


## Activity 3 (AWK)

 Data aggregation is an important task on databases in order to represent a data using few numbers(total, average, etc.). Awk can be use for such aggregating techniques especially in structured data like csv files.

 Task : Given the data in "employment.csv" you have to find sum of all entries in "Values" and append it to the end of the file ("Net : <sum>") and sum for each distinct entry in "High_industry" in the format ("entry_name : <sum>"). Separate the above from the original records using 5'='. See the below example (After printing "Net : <value>", all other entries should be in lexicographical order)

 Usage :
 
awk -f sum.awk employment.csv > output.txt

Eg :
 
Input ->

Week_end, Indicator, High_industry, Value

2019-05-05, Number of paid jobs - 34 days, Film, 2090110

2019-05-05, Number of paid jobs - 34 days, Agriculture, 95150

2019-05-05,Number of paid jobs - 34 days,Banking, 405050


Output ->

Week_end, Indicator,High_industry, Value

2019-05-05, Number of paid jobs - 34 days, Film,2090110

2019-05-05, Number of paid jobs - 34 days, Agriculture, 95150

2019-05-05, Number of paid jobs - 34 days, Banking, 405050


====

Net: 354478390

Agriculture : 7888120

Banking : 36859440

Film: 177256480

Manufacturing : 130092910

Railways : 2381440



## Activity 4 (AWK)

You are given a log file (log. txt) that records events in a system where items are produced and consumed. The file consists of statements in the following format:

• Produced x by master y
• Consumed x by worker y
• Master y exiting
• Worker y exiting

Each item produced is added to a buffer, and each consumed item is removed from it. Your task is to verify the correctness of this sequence using an AWK script (check. awk).



Given Variables

The following parameters define system constraints:

• TOTAL: Total number of items to produce (0 to TOTAL-1).
• BUF_SIZE: Maximum size of the buffer.
• NUM_MAS: Number of master threads (0 to NUM_MAS-1).
• NUM_WOR: Number of worker threads (0 to NUM_WOR-1).


Correctness Conditions

Your script must ensure that:

1. Each item [0 to TOTAL-1] is produced and consumed exactly once.
2. Each item is consumed only after it is produced.
3. The buffer size never exceeds BUF_SIZE at any point.
4. For each Produced x by master y statement:
5. y is a valid master thread (y NUM_MAS-1).
6. y must not have exited before this statement.
7. For each Consumed x by worker y statement:
8. y is a valid worker thread (y NUM_WOR-1).
9. y must not have exited before this statement.
10. Each master and worker thread exits exactly once and does not produce/consume after exiting.

Expected Output

• For each line in log. txt, print the buffer contents (space-separated, in any order) after the statement takes effect.
• At the end, print a single word:
• "YES" if the log is correct.
• "NO" if any of the conditions are violated.


Running Instructions

Command will be run with

awk -v TOTAL=3 -v BUF_SIZE=3 -v NUM_MAS=2 -v NUM_WOR=2 -f check. awk log.txt

Note the values of variables may differ and are found in params. txt




Example

Input (Log. txt)

Produced 0 by master 0

Produced 1 by master 0

Consumed 0 by worker 1

Produced 2 by master 1

Consumed 1 by worker Ø

Produced 3 by master 1

Consumed 2 by worker 1

Master 0 exiting

Consumed 3 by worker 0

Worker O exiting

Worker 1 exiting

Master 1 exiting


Output (check. awk result)

0
0 1
1
1 2
2
2 3
3
3



YES



Here, the log is correct, so the final output is "YES".



## Activity 5 (Sed + Awk)

You have data of some students in university and being a database administrator you are required to add a column to the given "students.csv" file for generating new email ids of the students.

Task : You are given "students.csv" file and you have to append a column named "Email-ID" to the database. The entries in email id are formed as:

<firstname><lastname>@surveycorps.com

Usage :

awk -f email.awk students.csv > output.txt

sed -Ef email.sed students.csv > output.txt



Eg :

Input ->

Student ID,First Name,Middle Name,Last Name

1001,Aarav, Rohit,Patel

1002, Ishani,Rani,Sharma


Output ->

Student ID,First Name,Middle Name,Last Name,Email-ID

1001,Aarav,Rohit,Patel,AaravPatel@surveycorps.com

1002, Ishani,Rani,Sharma, IshaniSharma@surveycorps.com

Note: You have to write two separate scripts (one sed and one awk), both doing the same task

Warning: Take care of spaces when using default awk configuration.
